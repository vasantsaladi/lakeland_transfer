# Lakeland Census Data ETL Project

This repository contains an ETL (Extract, Transform, Load) pipeline for processing historical census data from Lakeland. The project transforms raw census data into a structured database format and loads it into a Supabase PostgreSQL database.

![Database Schema](ERD/dbdiagram.io/ERD.svg)

## Table of Contents

- [Project Structure](#project-structure)
- [Database Schema](#database-schema)
- [Prerequisites](#prerequisites)
- [Setup Instructions](#setup-instructions)
- [Running the ETL Pipeline](#running-the-etl-pipeline)
- [Database Tables](#database-tables)
- [Troubleshooting](#troubleshooting)

## Project Structure

```
lakeland_transfer/
├── data/
│   ├── extracted/           # Raw census data files
│   │   ├── lakeland_1900_voter.csv
│   │   ├── lakeland_1920_voter.csv
│   │   └── ...
│   └── processed/          # Transformed CSV files
├── ERD/                    # Database schema files
│   └── dbdiagram.io/
│       ├── ERD.pdf
│       ├── ERD.sql
│       ├── ERD.svg
│       └── dbdiagram.io_schema.dbml
├── notebooks/             # Jupyter notebooks for ETL
│   ├── 1.transform.ipynb
│   └── 2.load.ipynb
├── .env.example          # Example environment variables
├── requirements.txt      # Python dependencies
└── README.md            # This file
```

## Database Schema

The database consists of the following tables with their relationships:

![ERD Diagram](ERD/dbdiagram.io/ERD.svg)

### Key Tables:

- `census_records`: Core table containing census year and source information
- `persons`: Individual person records with names
- `personal_attributes`: Demographics like age, sex, race
- `locations`: Address and dwelling information
- `families`: Family unit information
- `relationships`: Family relationships
- `occupations`: Work and business information
- `property_status`: Property ownership details
- `marital_status`: Marital status information

## Prerequisites

1. Python 3.8 or higher
2. Supabase account and project
3. Git (for cloning the repository)
4. PostgreSQL client (optional, for direct database access)

## Setup Instructions

### 1. Clone the Repository and Create Python Environment

```bash
# Clone the repository
git clone <repository-url>
cd lakeland_transfer

# Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

# Install requirements
pip install -r requirements.txt
```

### 2. Set Up Database Schema in Supabase

1. Go to [dbdiagram.io](https://dbdiagram.io)
2. Copy and paste the contents of `ERD/dbdiagram.io/dbdiagram.io_schema.dbml`
3. Export the PostgreSQL schema
4. In your Supabase project:
   - Navigate to SQL Editor
   - Create a new query
   - Paste the exported SQL schema
   - Run the query to create all tables

The schema should look like this:
![Database Tables](ERD/dbdiagram.io/ERD.pdf)

### 3. Configure Environment Variables

1. Copy the example environment file:

```bash
cp .env.example .env.local
```

2. Update `.env.local` with your Supabase credentials:

```
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-supabase-anon-key
```

## Running the ETL Pipeline

### 1. Data Transformation

1. Open Jupyter Notebook:

```bash
jupyter notebook
```

2. Navigate to `1.transform.ipynb`
3. Select your Python environment kernel
4. Run all cells
5. Verify the "Move on to load" message appears

### 2. Data Loading

1. Open `2.load.ipynb`
2. Select your Python environment kernel
3. Run all cells
4. Monitor the loading progress

### 3. Verify Data Load

1. Check your Supabase dashboard
2. Verify the table structure matches the ERD
3. Sample data should look like this:
   ![Sample Data](ERD/dbdiagram.io/ERD.svg)

## Database Tables

The database includes the following tables with their relationships:

```sql
CREATE TABLE "census_records" (
  "record_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "census_year" int NOT NULL,
  "source_pk" int NOT NULL,
  "ed" varchar(50),
  "page_number" varchar(50),
  "created_at" timestamp DEFAULT (CURRENT_TIMESTAMP)
);

-- Additional table definitions can be found in ERD/dbdiagram.io/ERD.sql
```

## Troubleshooting

Common issues and solutions:

1. **Environment Setup Issues**

   - Ensure Python version compatibility
   - Verify all requirements are installed
   - Check virtual environment activation

2. **Database Connection Issues**

   - Verify Supabase credentials in `.env.local`
   - Check network connectivity
   - Ensure proper table permissions

3. **Data Loading Issues**
   - Verify CSV file formats
   - Check for missing required fields
   - Ensure proper data types

For additional support, please refer to the documentation or open an issue in the repository.
